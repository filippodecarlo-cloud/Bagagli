<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Bagagli - Lista Interattiva</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        /* Modalit√† Scura */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-mode .container {
            background: rgba(30, 30, 46, 0.95);
        }

        body.dark-mode .header h1 {
            color: #e0e0e0;
        }

        body.dark-mode .header p {
            color: #b0b0b0;
        }

        body.dark-mode .category {
            background: #2a2a3e;
            border-color: transparent;
        }

        body.dark-mode .category:hover {
            border-color: #667eea;
        }

        body.dark-mode .category-title {
            color: #e0e0e0;
        }

        body.dark-mode .category-header {
            border-bottom-color: #3a3a4e;
        }

        body.dark-mode .item {
            background: #1e1e2e;
            color: #e0e0e0;
        }

        body.dark-mode .item:hover {
            background: #2a2a3e;
        }

        body.dark-mode .item-text {
            color: #e0e0e0;
        }

        body.dark-mode .item.checked {
            background: #1a4d2e;
        }

        body.dark-mode .stat {
            background: #2a2a3e;
        }

        body.dark-mode .stat-label {
            color: #b0b0b0;
        }

        body.dark-mode .font-controls {
            background: rgba(42, 42, 62, 0.9);
        }

        body.dark-mode .font-size-label {
            color: #e0e0e0;
        }

        body.dark-mode .hidden-item {
            background: #2a2a3e;
        }

        body.dark-mode .progress-bar {
            background: #2a2a3e;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .theme-toggle {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }

        .add-item-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #ecf0f1;
        }

        body.dark-mode .add-item-container {
            border-top-color: #3a3a4e;
        }

        .add-item-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #00b894, #55a3ff);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-item-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .add-item-form {
            display: none;
            margin-top: 10px;
            gap: 10px;
        }

        .add-item-form.active {
            display: flex;
        }

        .add-item-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1em;
            outline: none;
            transition: all 0.3s ease;
        }

        .add-item-input:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        body.dark-mode .add-item-input {
            background: #1e1e2e;
            color: #e0e0e0;
            border-color: #667eea;
        }

        .add-item-form-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-item-form-btn.save {
            background: linear-gradient(45deg, #00b894, #55a3ff);
            color: white;
        }

        .add-item-form-btn.cancel {
            background: #e74c3c;
            color: white;
        }

        .add-item-form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .item.custom-item {
            border-left: 3px solid #00b894;
        }

        .controls-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .font-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .font-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .font-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .font-size-label {
            font-size: 0.9em;
            color: #2c3e50;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }

        /* Classi dinamiche per dimensione testo */
        .font-small .item-text {
            font-size: 0.9em;
        }

        .font-small .item {
            padding: 10px;
            gap: 8px;
        }

        .font-small .item-list {
            gap: 8px;
        }

        .font-small .category-title {
            font-size: 1.3em;
        }

        .font-small .hidden-item {
            padding: 12px;
        }

        .font-medium .item-text {
            font-size: 1.1em;
        }

        .font-medium .item {
            padding: 15px;
            gap: 12px;
        }

        .font-medium .item-list {
            gap: 12px;
        }

        .font-medium .category-title {
            font-size: 1.5em;
        }

        .font-medium .hidden-item {
            padding: 15px;
        }

        .font-large .item-text {
            font-size: 1.3em;
        }

        .font-large .item {
            padding: 18px;
            gap: 15px;
        }

        .font-large .item-list {
            gap: 15px;
        }

        .font-large .category-title {
            font-size: 1.7em;
        }

        .font-large .hidden-item {
            padding: 18px;
        }

        .font-xlarge .item-text {
            font-size: 1.5em;
        }

        .font-xlarge .item {
            padding: 20px;
            gap: 18px;
        }

        .font-xlarge .item-list {
            gap: 18px;
        }

        .font-xlarge .category-title {
            font-size: 1.9em;
        }

        .font-xlarge .hidden-item {
            padding: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .category {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .category:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }

        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .category-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .category-title {
            flex: 1;
            font-size: 1.5em;
            font-weight: 700;
            color: #2c3e50;
        }

        .category-count {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .item.checked {
            opacity: 0.6;
            text-decoration: line-through;
            background: #d4edda;
        }

        .item.hidden {
            display: none;
        }

        .item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .item-text {
            flex: 1;
            font-size: 1.1em;
            color: #2c3e50;
        }

        .view-mode-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .view-mode-controls .btn {
            font-size: 0.9em;
            padding: 8px 16px;
        }

        .view-mode-controls .btn.active {
            background: linear-gradient(45deg, #00b894, #55a3ff);
            transform: scale(1.05);
        }

        .item.hidden-inline {
            display: flex !important;
            background: linear-gradient(135deg, #ffcccc, #ffaaaa);
            opacity: 0.8;
            text-decoration: line-through;
            border: 2px dashed #ff6b6b;
            position: relative;
        }

        .item.hidden-inline::after {
            content: "‚úÖ";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
        }

        .item.hidden-inline:hover {
            background: linear-gradient(135deg, #ffaaaa, #ff8888);
            transform: translateX(5px);
        }

        .item.hidden-inline .item-text {
            color: #721c24;
            font-weight: 600;
        }

        .hidden-section {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .hidden-section.show {
            display: block;
        }

        .hidden-section.inline-mode {
            display: none !important;
        }

        .hidden-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .hidden-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #2c3e50;
        }

        .hidden-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .hidden-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .hidden-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .restore-btn {
            background: linear-gradient(45deg, #00b894, #55a3ff);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .restore-btn:hover {
            transform: scale(1.05);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            min-width: 120px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .category-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle" title="Cambia tema">üåô</button>
    <div class="container">
        <div class="header">
            <h1>‚úàÔ∏è Gestione Bagagli</h1>
            <p>Organizza la tua valigia in modo intelligente</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="totalItems">0</div>
                <div class="stat-label">Totale</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="checkedItems">0</div>
                <div class="stat-label">Completati</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="remainingItems">0</div>
                <div class="stat-label">Rimanenti</div>
            </div>
        </div>

        <div class="controls-row">
            <div class="font-controls">
                <button class="font-btn" onclick="decreaseFontSize()" title="Diminuisci dimensione testo">A-</button>
                <span class="font-size-label" id="fontSizeLabel">Medio</span>
                <button class="font-btn" onclick="increaseFontSize()" title="Aumenta dimensione testo">A+</button>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="toggleHiddenSection()">
                üì¶ Visualizza Nascosti
            </button>
            <div class="view-mode-controls" id="viewModeControls" style="display: none;">
                <button class="btn btn-secondary" onclick="setViewMode('inline')" id="inlineBtn">
                    üìç Nella Posizione Originale
                </button>
                <button class="btn btn-secondary" onclick="setViewMode('bottom')" id="bottomBtn">
                    üìã In Fondo alla Lista
                </button>
            </div>
            <button class="btn btn-secondary" onclick="restoreAll()">
                üîÑ Ripristina Tutto
            </button>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="exportData()">
                üíæ Scarica Lista
            </button>
            <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">
                üìÇ Carica Lista
            </button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        </div>

        <div class="category-grid" id="categoryGrid">
            <!-- Le categorie verranno generate dinamicamente -->
        </div>

        <div class="hidden-section" id="hiddenSection">
            <div class="hidden-header">
                <h2 class="hidden-title">üì¶ Oggetti Nascosti</h2>
                <button class="btn btn-primary" onclick="toggleHiddenSection()">Nascondi</button>
            </div>
            <div class="hidden-items" id="hiddenItems">
                <!-- Gli oggetti nascosti verranno mostrati qui -->
            </div>
        </div>
    </div>

    <script>
        // Dati delle categorie con i rispettivi oggetti
        const categories = {
            "Vestiti": {
                icon: "üëï",
                items: [
                    "Calzini", "Mutande", "Magliette", "Ciabatte Mare/Casa", "Camice", 
                    "Felpa", "Vestito Completo", "Cappellino", "Canottiera", 
                    "Scarpe Ginnastica", "Pantaloncini", "Pantaloni", "Scarpe Normali", 
                    "Pigiama", "Occhiali da vista"
                ]
            },
            "Sport": {
                icon: "‚öΩ",
                items: [
                    "Calzini Sport", "Costume", "Cuffia per piscina", "Scarpe trekking", 
                    "Calzinin lana", "Poncho o k-way", "Palla calcio volley", 
                    "Bastoni montagna", "Tenda spiaggia", "Tappi orecchie nuoto"
                ]
            },
            "Biancheria": {
                icon: "üõèÔ∏è",
                items: [
                    "Sacco Pelo", "Lenzuoli", "Asciugamano", "Accappatoio", "Canovaccio"
                ]
            },
            "Cibo": {
                icon: "üçΩÔ∏è",
                items: [
                    "Cibo Viaggio", "Sale", "Olio", "Aceto", "Cipolla", "Aglio", 
                    "Detersivo Piatti", "Contenitori merende", "Termos Caff√®", "Red Bull"
                ]
            },
            "Beauty": {
                icon: "üíÑ",
                items: [
                    "Occhiali Sole", "Spazzolino", "Dentifricio", "Saponetta", "Profumo", 
                    "Deodorante", "Shampoo", "Cuffia per doccia", "Crema Solare", "Phon", 
                    "Pomate e medicinali", "Detersivo", "Filo Per Stendere", "Mollette", 
                    "Forbicine", "Ago/Filo", "Attak", "Collirio", "Cerotti", "Cotone idrofilo", 
                    "Assorbenti inizio", "Assorbenti fine", "Trusse", "Burro di cacao", 
                    "Rasoio/Schiuma", "Cotton Fiok", "Tappi orecchie", "Spazzola", 
                    "Detergente intimo", "Spugna", "Fazzolettini", "Termometro", "Autan", 
                    "Salviettine detergenti", "Lenti a contatto", "Caricatore smartwatch", 
                    "Vitamine", "Reparil"
                ]
            },
            "Utilit√†": {
                icon: "üîß",
                items: [
                    "Scotch", "Adattatore prese estere", "Sveglia", "Accendino", 
                    "Coltellino multiuso", "Soldi", "Documenti", "Biglietti treno", 
                    "Kit dormire treno", "Macchina Foto", "Libri", "Agenda Indirizzi", 
                    "Penna", "Astuccio", "Chitarra", "Spartiti", "Vape", "Chiavi Case", 
                    "Ombrello", "Marsupio", "Walkman", "Telefonino", "Caricabatterie", 
                    "Drone", "Torcia", "Guida Turistica", "Borraccia", "Lucchetto Con Chiave", 
                    "Binocolo", "Zaino", "Carta igienica", "PC Portatile", "Macchina foto digitale", 
                    "Carte", "Scacchi", "Palloncini (attaccapanni)", "Federa (cuscino aereo)", 
                    "Sacchetti cuky", "Sacchetty vuoti", "Busta trasparente", "Ipad", 
                    "Monopiede", "Auricolari", "Caricatore portatile", "Zaino bimbo", 
                    "Mascherine", "Cuscino Franci", "Passeggino"
                ]
            },
            "Partenza": {
                icon: "üö™",
                items: [
                    "Chiudere Acqua Luce Gas", "Frigo Vuoto E Aperto", "Spazzatura", 
                    "Finestre Chiuse", "Spengere caldaia", "Spengere ADSL", "Spostare auto"
                ]
            }
        };

        let hiddenItems = [];
        let allItems = [];
        let currentFontSize = 'medium';
        let showHiddenItems = false;
        let viewMode = 'bottom'; // 'inline' o 'bottom'
        const fontSizes = ['small', 'medium', 'large', 'xlarge'];
        const fontLabels = ['Piccolo', 'Medio', 'Grande', 'Molto Grande'];
        let customItems = {}; // Oggetti personalizzati per categoria

        // ===== FUNZIONI PER GESTIONE OGGETTI PERSONALIZZATI =====
        
        // Mostra il form per aggiungere un oggetto
        function showAddItemForm(categoryName) {
            const formId = categoryName.replace(/\s+/g, '-');
            const form = document.getElementById(`add-form-${formId}`);
            if (form) {
                const input = form.querySelector('.add-item-input');
                form.classList.add('active');
                if (input) input.focus();
            }
        }

        // Nascondi il form per aggiungere un oggetto
        function hideAddItemForm(categoryName) {
            const formId = categoryName.replace(/\s+/g, '-');
            const form = document.getElementById(`add-form-${formId}`);
            if (form) {
                const input = form.querySelector('.add-item-input');
                form.classList.remove('active');
                if (input) input.value = '';
            }
        }

        // Aggiungi un oggetto personalizzato
        function addCustomItem(categoryName) {
            const formId = categoryName.replace(/\s+/g, '-');
            const form = document.getElementById(`add-form-${formId}`);
            if (!form) return;
            
            const input = form.querySelector('.add-item-input');
            if (!input) return;
            
            const itemName = input.value.trim();
            
            if (!itemName) {
                alert('‚ö†Ô∏è Inserisci il nome dell\'oggetto!');
                return;
            }
            
            // Inizializza l'array se non esiste
            if (!customItems[categoryName]) {
                customItems[categoryName] = [];
            }
            
            // Controlla se l'oggetto esiste gi√†
            const allCategoryItems = [...categories[categoryName].items];
            if (customItems[categoryName]) {
                allCategoryItems.push(...customItems[categoryName]);
            }
            
            if (allCategoryItems.includes(itemName)) {
                alert('‚ö†Ô∏è Questo oggetto esiste gi√† nella lista!');
                return;
            }
            
            // Aggiungi l'oggetto
            customItems[categoryName].push(itemName);
            
            // Salva e rigenera
            saveState();
            generateCategories();
            loadState();
            updateStats();
            
            alert('‚úÖ Oggetto aggiunto con successo!');
        }

        // Aggiungi event listeners agli elementi
        function addEventListeners() {
            // Event listener per gli item
            document.querySelectorAll('.item').forEach(item => {
                item.addEventListener('click', function(event) {
                    toggleItem(this, event);
                });
            });

            // Event listener per i pulsanti "Aggiungi Voce"
            document.querySelectorAll('.add-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryName = this.getAttribute('data-category');
                    showAddItemForm(categoryName);
                });
            });

            // Event listener per i pulsanti di salvataggio
            document.querySelectorAll('.add-item-form-btn.save').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryName = this.getAttribute('data-category');
                    addCustomItem(categoryName);
                });
            });

            // Event listener per i pulsanti di annullamento
            document.querySelectorAll('.add-item-form-btn.cancel').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryName = this.getAttribute('data-category');
                    hideAddItemForm(categoryName);
                });
            });

            // Event listener per Enter negli input
            document.querySelectorAll('.add-item-input').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const categoryName = this.getAttribute('data-category');
                        addCustomItem(categoryName);
                    }
                });
            });
        }

        // ===== FINE FUNZIONI OGGETTI PERSONALIZZATI =====

        // Export dei dati
        function exportData() {
            const data = {
                checkedItems: [],
                fontSize: currentFontSize,
                viewMode: viewMode,
                customItems: customItems,
                exportDate: new Date().toISOString()
            };

            document.querySelectorAll('.item.checked').forEach(item => {
                data.checkedItems.push(item.querySelector('.item-text').textContent);
            });

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `bagagli-lista-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            alert('‚úÖ Lista scaricata con successo!');
        }

        // Import dei dati
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Ripristina tutti gli elementi prima di importare
                    restoreAll();
                    
                    // Carica oggetti personalizzati
                    if (data.customItems) {
                        customItems = data.customItems;
                    }
                    
                    // Rigenera le categorie con gli oggetti personalizzati
                    generateCategories();
                    
                    // Applica i dati importati
                    if (data.fontSize && fontSizes.includes(data.fontSize)) {
                        setFontSize(data.fontSize);
                    }
                    
                    if (data.viewMode) {
                        viewMode = data.viewMode;
                    }
                    
                    if (data.checkedItems && Array.isArray(data.checkedItems)) {
                        setTimeout(() => {
                            document.querySelectorAll('.item').forEach(item => {
                                const itemText = item.querySelector('.item-text').textContent;
                                if (data.checkedItems.includes(itemText)) {
                                    const checkbox = item.querySelector('input[type="checkbox"]');
                                    checkbox.checked = true;
                                    item.classList.add('checked', 'hidden');
                                    
                                    hiddenItems.push({
                                        text: itemText,
                                        element: item
                                    });
                                }
                            });
                            
                            updateStats();
                            updateProgress();
                            updateHiddenSection();
                            saveState();
                            
                            alert('‚úÖ Lista caricata con successo!');
                        }, 100);
                    }
                } catch (error) {
                    alert('‚ùå Errore nel caricamento del file. Assicurati che sia un file valido.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
            
            // Reset input per permettere di caricare lo stesso file
            event.target.value = '';
        }

        // Condivisione tramite link
        function shareList() {
            const data = {
                checkedItems: [],
                fontSize: currentFontSize,
                viewMode: viewMode
            };

            document.querySelectorAll('.item.checked').forEach(item => {
                data.checkedItems.push(item.querySelector('.item-text').textContent);
            });

            // Comprimi i dati in base64
            const dataStr = JSON.stringify(data);
            const encoded = btoa(encodeURIComponent(dataStr));
            
            // Crea il link
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = `${baseUrl}?data=${encoded}`;
            
            document.getElementById('shareLink').textContent = shareUrl;
            document.getElementById('shareModal').classList.add('show');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
            document.getElementById('copyBtn').textContent = 'üìã Copia';
            document.getElementById('copyBtn').classList.remove('copied');
        }

        function copyShareLink() {
            const link = document.getElementById('shareLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.textContent = '‚úÖ Copiato!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.textContent = 'üìã Copia';
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                alert('Errore nella copia del link. Copialo manualmente.');
            });
        }

        // Carica dati da URL
        function loadFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const dataStr = decodeURIComponent(atob(dataParam));
                    const data = JSON.parse(dataStr);
                    
                    // Applica i dati
                    if (data.fontSize && fontSizes.includes(data.fontSize)) {
                        setFontSize(data.fontSize);
                    }
                    
                    if (data.viewMode) {
                        viewMode = data.viewMode;
                    }
                    
                    if (data.checkedItems && Array.isArray(data.checkedItems)) {
                        document.querySelectorAll('.item').forEach(item => {
                            const itemText = item.querySelector('.item-text').textContent;
                            if (data.checkedItems.includes(itemText)) {
                                const checkbox = item.querySelector('input[type="checkbox"]');
                                checkbox.checked = true;
                                item.classList.add('checked', 'hidden');
                                
                                hiddenItems.push({
                                    text: itemText,
                                    element: item
                                });
                            }
                        });
                        
                        updateStats();
                        updateProgress();
                        updateHiddenSection();
                        saveState();
                        
                        // Rimuovi il parametro dall'URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                        
                        alert('‚úÖ Lista caricata dal link condiviso!');
                    }
                } catch (error) {
                    console.error('Errore nel caricamento dei dati dall\'URL:', error);
                }
            }
        }

        // Chiudi modal cliccando fuori
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('shareModal');
            if (event.target === modal) {
                closeShareModal();
            }
        });

        // Inizializza l'app
        function initApp() {
            generateCategories();
            loadState(); // Carica lo stato salvato
            loadTheme(); // Carica il tema salvato
            updateStats();
            updateProgress();
            setFontSize(currentFontSize || 'medium');
        }

        // Salva lo stato nel localStorage
        function saveState() {
            const checkedItems = [];
            document.querySelectorAll('.item.checked').forEach(item => {
                checkedItems.push(item.querySelector('.item-text').textContent);
            });
            localStorage.setItem('bagagliCheckedItems', JSON.stringify(checkedItems));
            localStorage.setItem('bagagliFontSize', currentFontSize);
            localStorage.setItem('bagagliViewMode', viewMode);
            localStorage.setItem('bagagliCustomItems', JSON.stringify(customItems));
        }

        // Carica lo stato dal localStorage
        function loadState() {
            const savedItems = localStorage.getItem('bagagliCheckedItems');
            const savedFontSize = localStorage.getItem('bagagliFontSize');
            const savedViewMode = localStorage.getItem('bagagliViewMode');
            const savedCustomItems = localStorage.getItem('bagagliCustomItems');

            if (savedCustomItems) {
                try {
                    customItems = JSON.parse(savedCustomItems);
                } catch (e) {
                    customItems = {};
                }
            }

            if (savedItems) {
                const checkedItems = JSON.parse(savedItems);
                document.querySelectorAll('.item').forEach(item => {
                    const itemText = item.querySelector('.item-text').textContent;
                    if (checkedItems.includes(itemText)) {
                        const checkbox = item.querySelector('input[type="checkbox"]');
                        checkbox.checked = true;
                        item.classList.add('checked', 'hidden');
                        
                        // Aggiungi agli oggetti nascosti
                        hiddenItems.push({
                            text: itemText,
                            element: item
                        });
                    }
                });
            }

            if (savedFontSize && fontSizes.includes(savedFontSize)) {
                setFontSize(savedFontSize);
            }

            if (savedViewMode) {
                viewMode = savedViewMode;
            }
        }

        // Salva e carica il tema
        function loadTheme() {
            const savedTheme = localStorage.getItem('bagagliTheme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('themeToggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('bagagliTheme', isDark ? 'dark' : 'light');
        }

        // Gestisce la modalit√† di visualizzazione
        function setViewMode(mode) {
            viewMode = mode;
            
            // Aggiorna i pulsanti attivi
            document.getElementById('inlineBtn').classList.toggle('active', mode === 'inline');
            document.getElementById('bottomBtn').classList.toggle('active', mode === 'bottom');
            
            if (showHiddenItems) {
                displayHiddenItems();
            }
            
            saveState(); // Salva lo stato
        }

        // Visualizza gli oggetti nascosti in base alla modalit√†
        function displayHiddenItems() {
            const hiddenSection = document.getElementById('hiddenSection');
            
            if (viewMode === 'inline') {
                // Mostra gli oggetti nella posizione originale
                hiddenSection.classList.add('inline-mode');
                hiddenItems.forEach(item => {
                    item.element.classList.remove('hidden');
                    item.element.classList.add('hidden-inline');
                });
            } else {
                // Mostra gli oggetti in fondo
                hiddenSection.classList.remove('inline-mode');
                hiddenItems.forEach(item => {
                    item.element.classList.add('hidden');
                    item.element.classList.remove('hidden-inline');
                });
                updateHiddenSection();
            }
        }

        // Mostra/nascondi la sezione degli oggetti nascosti
        function toggleHiddenSection() {
            const hiddenSection = document.getElementById('hiddenSection');
            const viewModeControls = document.getElementById('viewModeControls');
            
            showHiddenItems = !showHiddenItems;
            
            if (showHiddenItems && hiddenItems.length > 0) {
                viewModeControls.style.display = 'flex';
                hiddenSection.classList.add('show');
                
                // Imposta la modalit√† predefinita se non √® gi√† stata impostata
                if (!document.getElementById('inlineBtn').classList.contains('active') && 
                    !document.getElementById('bottomBtn').classList.contains('active')) {
                    setViewMode('bottom');
                }
                
                displayHiddenItems();
            } else if (showHiddenItems && hiddenItems.length === 0) {
                // Se non ci sono oggetti nascosti, mostra un messaggio
                alert('Non ci sono oggetti nascosti da visualizzare!');
                showHiddenItems = false;
            } else {
                viewModeControls.style.display = 'none';
                hiddenSection.classList.remove('show');
                hiddenSection.classList.remove('inline-mode');
                
                // Nascondi tutti gli oggetti nascosti
                hiddenItems.forEach(item => {
                    item.element.classList.add('hidden');
                    item.element.classList.remove('hidden-inline');
                });
            }
        }

        // Gestisce la dimensione del testo
        function increaseFontSize() {
            const currentIndex = fontSizes.indexOf(currentFontSize);
            if (currentIndex < fontSizes.length - 1) {
                setFontSize(fontSizes[currentIndex + 1]);
            }
        }

        function decreaseFontSize() {
            const currentIndex = fontSizes.indexOf(currentFontSize);
            if (currentIndex > 0) {
                setFontSize(fontSizes[currentIndex - 1]);
            }
        }

        function setFontSize(size) {
            const container = document.querySelector('.container');
            
            // Rimuovi tutte le classi di dimensione font
            fontSizes.forEach(fontSize => {
                container.classList.remove(`font-${fontSize}`);
            });
            
            // Aggiungi la nuova classe
            container.classList.add(`font-${size}`);
            currentFontSize = size;
            
            // Aggiorna l'etichetta
            const sizeIndex = fontSizes.indexOf(size);
            document.getElementById('fontSizeLabel').textContent = fontLabels[sizeIndex];
            
            saveState(); // Salva lo stato
        }

        // Genera le categorie HTML
        function generateCategories() {
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = '';

            Object.entries(categories).forEach(([categoryName, categoryData]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                
                // Combina oggetti di default con oggetti personalizzati
                const allCategoryItems = [...categoryData.items];
                if (customItems[categoryName]) {
                    allCategoryItems.push(...customItems[categoryName]);
                }
                
                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <span class="category-icon">${categoryData.icon}</span>
                        <span class="category-title">${categoryName}</span>
                        <span class="category-count">${allCategoryItems.length}</span>
                    </div>
                    <div class="item-list">
                        ${allCategoryItems.map((item, index) => {
                            const isCustom = customItems[categoryName] && customItems[categoryName].includes(item);
                            return `
                                <div class="item ${isCustom ? 'custom-item' : ''}" data-item-text="${item}">
                                    <input type="checkbox">
                                    <span class="item-text">${item}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div class="add-item-container">
                        <button class="add-item-btn" data-category="${categoryName}">
                            ‚ûï Aggiungi Voce
                        </button>
                        <div class="add-item-form" id="add-form-${categoryName.replace(/\s+/g, '-')}">
                            <input type="text" class="add-item-input" placeholder="Nome oggetto..." data-category="${categoryName}">
                            <button class="add-item-form-btn save" data-category="${categoryName}">‚úì</button>
                            <button class="add-item-form-btn cancel" data-category="${categoryName}">‚úï</button>
                        </div>
                    </div>
                `;
                categoryGrid.appendChild(categoryDiv);
            });

            // Aggiungi event listeners
            addEventListeners();

            // Aggiorna l'array di tutti gli oggetti
            allItems = [];
            Object.entries(categories).forEach(([categoryName, category]) => {
                allItems = allItems.concat(category.items);
                if (customItems[categoryName]) {
                    allItems = allItems.concat(customItems[categoryName]);
                }
            });
        }

        // Aggiungi event listeners agli elementi
        function addEventListeners() {
            // Event listener per gli item
            document.querySelectorAll('.item').forEach(item => {
                item.addEventListener('click', function(event) {
                    toggleItem(this, event);
                });
            });

            // Event listener per i pulsanti "Aggiungi Voce"
            document.querySelectorAll('.add-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryName = this.getAttribute('data-category');
                    showAddItemForm(categoryName);
                });
            });

            // Event listener per i pulsanti di salvataggio
            document.querySelectorAll('.add-item-form-btn.save').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryName = this.getAttribute('data-category');
                    addCustomItem(categoryName);
                });
            });

            // Event listener per i pulsanti di annullamento
            document.querySelectorAll('.add-item-form-btn.cancel').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryName = this.getAttribute('data-category');
                    hideAddItemForm(categoryName);
                });
            });

            // Event listener per Enter negli input
            document.querySelectorAll('.add-item-input').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const categoryName = this.getAttribute('data-category');
                        addCustomItem(categoryName);
                    }
                });
            });
        }

        // Gestisce il click su un oggetto
        function toggleItem(element, event) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            const itemText = element.querySelector('.item-text').textContent;
            
            // Se il click √® sulla checkbox, non fare nulla perch√© cambia stato automaticamente
            if (event && event.target === checkbox) {
                // La checkbox ha gi√† cambiato stato, usiamo il suo nuovo stato
            } else {
                // Se il click √® sul div o sul testo, cambia lo stato della checkbox
                checkbox.checked = !checkbox.checked;
            }
            
            if (checkbox.checked) {
                element.classList.add('checked');
                // Dopo 1 secondo, nascondi l'elemento
                setTimeout(() => {
                    // Aggiungi alla lista degli oggetti nascosti
                    hiddenItems.push({
                        text: itemText,
                        element: element
                    });
                    
                    // Se non stiamo mostrando gli oggetti nascosti, nascondili
                    if (!showHiddenItems) {
                        element.classList.add('hidden');
                    } else {
                        // Se stiamo mostrando gli oggetti nascosti, applica la modalit√† corrente
                        displayHiddenItems();
                    }
                    
                    updateStats();
                    updateProgress();
                    updateHiddenSection();
                    saveState(); // Salva lo stato
                }, 1000);
            } else {
                // Rimuovi dalla lista degli oggetti nascosti
                const index = hiddenItems.findIndex(item => item.element === element);
                if (index !== -1) {
                    hiddenItems.splice(index, 1);
                }
                
                element.classList.remove('checked', 'hidden', 'hidden-inline');
                updateStats();
                updateProgress();
                updateHiddenSection();
                saveState(); // Salva lo stato
            }
        }

        // Aggiorna le statistiche
        function updateStats() {
            const totalItems = allItems.length;
            const visibleItems = document.querySelectorAll('.item:not(.hidden)');
            const checkedVisibleItems = document.querySelectorAll('.item.checked:not(.hidden)');
            const totalChecked = document.querySelectorAll('.item.checked').length;
            const remaining = totalItems - totalChecked;

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('checkedItems').textContent = totalChecked;
            document.getElementById('remainingItems').textContent = remaining;
        }

        // Aggiorna la barra di progresso
        function updateProgress() {
            const totalItems = allItems.length;
            const checkedItems = document.querySelectorAll('.item.checked').length;
            const progress = (checkedItems / totalItems) * 100;
            
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Aggiorna la sezione degli oggetti nascosti
        function updateHiddenSection() {
            const hiddenItemsContainer = document.getElementById('hiddenItems');
            hiddenItemsContainer.innerHTML = '';

            hiddenItems.forEach((item, index) => {
                const hiddenDiv = document.createElement('div');
                hiddenDiv.className = 'hidden-item';
                hiddenDiv.innerHTML = `
                    <span>${item.text}</span>
                    <button class="restore-btn" onclick="restoreItem(${index})">
                        Ripristina
                    </button>
                `;
                hiddenItemsContainer.appendChild(hiddenDiv);
            });
        }

        // Ripristina un singolo oggetto
        function restoreItem(index) {
            const item = hiddenItems[index];
            item.element.classList.remove('hidden', 'checked', 'hidden-inline');
            item.element.querySelector('input[type="checkbox"]').checked = false;
            
            hiddenItems.splice(index, 1);
            updateStats();
            updateProgress();
            updateHiddenSection();
            saveState(); // Salva lo stato
            
            // Se non ci sono pi√π oggetti nascosti, nascondi i controlli
            if (hiddenItems.length === 0) {
                showHiddenItems = false;
                document.getElementById('viewModeControls').style.display = 'none';
                document.getElementById('hiddenSection').classList.remove('show');
            }
        }

        // Ripristina tutti gli oggetti
        function restoreAll() {
            hiddenItems.forEach(item => {
                item.element.classList.remove('hidden', 'checked', 'hidden-inline');
                item.element.querySelector('input[type="checkbox"]').checked = false;
            });
            
            hiddenItems = [];
            showHiddenItems = false;
            updateStats();
            updateProgress();
            updateHiddenSection();
            saveState(); // Salva lo stato
            
            // Nascondi i controlli
            document.getElementById('viewModeControls').style.display = 'none';
            document.getElementById('hiddenSection').classList.remove('show', 'inline-mode');
        }

        // Funzione originale rimossa e sostituita sopra

        // Avvia l'app quando la pagina √® caricata
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>